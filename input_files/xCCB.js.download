// JScript File

var onClickEvents = new Array();
var onClickarrayIndex=0;
function ProccessOnClick(){
    for (var i = 0; i < onClickEvents.length; i++)
    {
        if(!onClickEvents[i]()){
            return false;
        }
    }
    return true;
}




function addOnClickEvent(func) {
  onClickEvents[onClickarrayIndex] = func;
  onClickarrayIndex = onClickarrayIndex +1;
}

function addLoadEvent(func) {
    if(func == null){return;};
  var oldonload = window.onload;
  if (typeof window.onload != 'function') {
    window.onload = func;
  } else {
    window.onload = function() {
      if (oldonload) {
        oldonload();
      }
      func();
    }
  }
}

function addUpdatePanelLoadEvent(func) {
  var panel=document.getElementById('behaviorsPanel');
  var oldonload = panel.onload;
  if (typeof panel.onload != 'function') {
    panel.onload = func;
  } else {
    panel.onload = function() {
      if (oldonload) {
        oldonload();
      }
      func();
    }
  }
}


function addPostBackEvent(func) {
  var oldonpostback = document.forms['aspnetForm'].onsubmit;
  if (typeof document.forms['aspnetForm'].onsubmit != 'function') {
    document.forms['aspnetForm'].onsubmit = func;
  } else {
    document.forms['aspnetForm'].onsubmit = function() {
      func();
      if (oldonpostback) {
        return oldonpostback();
      }      
    }
  }
}



function popup(html, height)
{
    var oPopup = window.createPopup();
    var oPopBody = oPopup.document.body;
    oPopBody.innerHTML = html; // nosemgrep: javascript.browser.security
    // Parameters of the show method are in the following order: x-coordinate,
    // y-coordinate, width, height, and the element to which the x,y 
    // coordinates are relative. Note that this popup object is displayed
    // relative to the body of the document.
    
    
    oPopup.show(0, 15, 250, height, event.srcElement);

}

function MenuHover(item)
{
        item.style.backgroundColor ='#FFE6A0';
	    item.style.color = '#003399';
	    item.style.border ='1px solid #D2B47A';
	    item.style.cursor = 'pointer';
}

function MenuOut(item)
{
        item.style.backgroundColor ='';
	    item.style.color = '';
	    item.style.border ='';    
	    item.style.cursor = 'default';
}

var BrowserDetect = {
	init: function () {
		this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
		this.version = this.searchVersion(navigator.userAgent)
			|| this.searchVersion(navigator.appVersion)
			|| "an unknown version";
		this.OS = this.searchString(this.dataOS) || "an unknown OS";
	},
	searchString: function (data) {
		for (var i=0;i<data.length;i++)	{
			var dataString = data[i].string;
			var dataProp = data[i].prop;
			this.versionSearchString = data[i].versionSearch || data[i].identity;
			if (dataString) {
				if (dataString.indexOf(data[i].subString) != -1)
					return data[i].identity;
			}
			else if (dataProp)
				return data[i].identity;
		}
	},
	searchVersion: function (dataString) {
		var index = dataString.indexOf(this.versionSearchString);
		if (index == -1) return;
		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
	},
	dataBrowser: [
		{ 	string: navigator.userAgent,
			subString: "OmniWeb",
			versionSearch: "OmniWeb/",
			identity: "OmniWeb"
		},
		{
			string: navigator.vendor,
			subString: "Apple",
			identity: "Safari"
		},
		{
			prop: window.opera,
			identity: "Opera"
		},
		{
			string: navigator.vendor,
			subString: "iCab",
			identity: "iCab"
		},
		{
			string: navigator.vendor,
			subString: "KDE",
			identity: "Konqueror"
		},
		{
			string: navigator.userAgent,
			subString: "Firefox",
			identity: "Firefox"
		},
		{
			string: navigator.vendor,
			subString: "Camino",
			identity: "Camino"
		},
		{		// for newer Netscapes (6+)
			string: navigator.userAgent,
			subString: "Netscape",
			identity: "Netscape"
		},
		{
			string: navigator.userAgent,
			subString: "MSIE",
			identity: "Explorer",
			versionSearch: "MSIE"
		},
		{
			string: navigator.userAgent,
			subString: "Gecko",
			identity: "Mozilla",
			versionSearch: "rv"
		},
		{ 		// for older Netscapes (4-)
			string: navigator.userAgent,
			subString: "Mozilla",
			identity: "Netscape",
			versionSearch: "Mozilla"
		}
	],
	dataOS : [
		{
			string: navigator.platform,
			subString: "Win",
			identity: "Windows"
		},
		{
			string: navigator.platform,
			subString: "Mac",
			identity: "Mac"
		},
		{
			string: navigator.platform,
			subString: "Linux",
			identity: "Linux"
		}
	]

};
BrowserDetect.init();


    

function ConvertToLocalTime(UTCTime)
{
   var utc = new Date(UTCTime);
   var localOffset = GetLocalTimeOffset();
   
   var localTime = new Date(utc - (localOffset * 1000));
  
   return localTime.toLocaleString() + " (local time)";   
}

function GetLocalTimeOffset()
{
    // The getTimezoneOffset() method returns the difference in minutes between Greenwich Mean Time (GMT) and local time.
    // Ref - http://www.w3schools.com/jsref/jsref_getTimezoneOffset.asp

    var utc = new Date();    
    return utc.getTimezoneOffset() * 60; // return seconds
    
    // Why do we want ticks??
    //return utc.getTimezoneOffset() * 60000; // Convert to ticks
}

function ShowDiv(divID)
{
  var item=document.getElementById(divID);
  if (item !=null)
  { 
    item.style.display='block'; 
  }
}

function HideDiv(divID)
{
  var item=document.getElementById(divID);
  if (item !=null)
  { 
    item.style.display='none'; 
  }
}

/***Item Picker related Script *********/

String.prototype.trim = function(){return (this.replace(/^[\s\xA0]+/, "").replace(/[\s\xA0]+$/, ""))}
String.prototype.startsWith = function(str) {return (this.match("^"+str)==str)}
String.prototype.endsWith = function(str) {return (this.match(str+"$")==str)}

function getWSDL(contextSiteUrl,Function)
{
    myWebService.useService(contextSiteUrl + "/_vti_bin/Lists.asmx?WSDL",Function);            
}                

function UndoCheckOut(contextSiteUrl,absoluteURL)
{            
    getWSDL(contextSiteUrl,"UndoCheckOut");
    myWebService.UndoCheckOut.callService("UndoCheckOut", absoluteURL);
}

function OnItemPickerValidationSucceeded(result, userContext, methodName)
{
    ///TODO: The selection seems to deselect if you quickly type in more than 6 letters and quickly press down
    // Page element to display feedback.
    if (userContext && result)
    {   
        var controls = userContext.split("|");
        var selectedItems = document.getElementById(controls[0]);
        var errorControl = document.getElementById(controls[1]);
        var searchTextControl = document.getElementById(controls[2]);
        var hiddenTextField = document.getElementById(controls[3]);                        
        var singlePicker = controls[4];
        
        try
        {                      
            var results = result.split("|");
            if (selectedItems != null && hiddenTextField != null ){
                var currentValuesWithBlanks = hiddenTextField.value.split("|");
                var currentValues = [] ;
                for (valueIndex in currentValuesWithBlanks) {
                  if (currentValuesWithBlanks[valueIndex] && currentValuesWithBlanks[valueIndex] != '0') {
                    currentValues.push(currentValuesWithBlanks[valueIndex]);
                  }
                }


                if (singlePicker == 'True' && currentValues.length >= 1) {
                  searchTextControl.style.backgroundColor = '#989898';
                  searchTextControl.value = "";
                  selectedItems.focus();

                  searchTextControl.ReadOnly = true;
                  return false;
                }
                
                if (hiddenTextField.value.split('|')[1] != '' && singlePicker ==true) 
                {
                    searchTextControl.style.backgroundColor = '#989898';              
                    searchTextControl.value = "";
                    selectedItems.focus();
                    searchTextControl.disable=true;
                    searchTextControl.ReadOnly = true;                    
                    return false;
                    
                }
                
                var alreadyExists = false;
                for(valueIndex in currentValues){
                    if(currentValues[valueIndex] == results[2]){
                        alreadyExists = true;
                        break;
                    }
                }
            
                if (!results[1])
                {
                    alert("Unresolved display name for member. Please report this issue to xCCB support.");
                }
                if (!alreadyExists && results[0] && results[1] && results[0].toLowerCase() == "resolved")
                {    
                    var oOption = document.createElement("OPTION");
		            selectedItems.options.add(oOption);
		            oOption.innerText = results[1];
		            oOption.value = results[2];
		            
		            if (singlePicker == 'True')
                    {      
                        searchTextControl.style.backgroundColor = '#989898';              
                        searchTextControl.value = "";
                        selectedItems.focus();
                        searchTextControl.disable=true;
                        searchTextControl.ReadOnly = true;
                        
                        selectedItems.options[0].selected = true;
                    }
                    else
                    {
                        searchTextControl.ReadOnly =false;
                        searchTextControl.value = "";
                        searchTextControl.focus();
                    }
    		        
    		        if (hiddenTextField)
    		            hiddenTextField.value += "|" + results[2];
    		            
		            if (errorControl)
		                errorControl.innerText = "";
                }
                else if (results[0] && results[1] && results[0].toLowerCase() == "unresolved")
                {
                    if (errorControl)
                        errorControl.innerText = "Unresolved Name: " + results[1];
                }
                
                if (searchTextControl)
                {     
                    //if (singlePicker == 'True')
                    //{                 
                    
                }
            }
        }
        catch (err)
        {
            if (errorControl)
                errorControl.innerText = err.description;
        }
    }
}

function RemoveSelectedItemsFromListBoxNoPostBack(selectedItemsClientID, errorLabelID, hiddenFieldID, searchTextBox, extraControlNames, allowZeroLengthList)
{
    try
    {
        var objSearchBox = document.getElementById(searchTextBox); 
        var selectedItems = document.getElementById(selectedItemsClientID);
        var errorControl = document.getElementById(errorLabelID);
        var hiddenField = document.getElementById(hiddenFieldID);                
    
        if (selectedItems)
        {        
            if (selectedItems.length == 1 && allowZeroLengthList != "True")
             return false;
             
            for (var  i = 0; i < selectedItems.length; i++) 
            { 
                if (selectedItems.options[i].selected) 
                { 
                        // Code for handling removing tagging when a user is removed...not all people pickers have a tagging ctl so leave it
                        // this way...or re-do...
                        
                        
                        var controls = extraControlNames.split('|');
                        if (controls.length > 1)
                        {
                            var taggerHiddenDataField = document.getElementById(controls[0]);
                            var taggerRoleSummaryTextField  = document.getElementById(controls[1]);
                            RemoveTagging(taggerHiddenDataField, taggerRoleSummaryTextField, selectedItems.options[i].value );
                        }     
                        //alert("Before:"+hiddenField.value + " selected option: '" + selectedItems.options[i].value + "'");
                        if(hiddenField.value.indexOf("|" + selectedItems.options[i].value)>=0)
                            hiddenField.value = hiddenField.value.replace ("|" + selectedItems.options[i].value, "");    
                        else
                            hiddenField.value = hiddenField.value.replace (selectedItems.options[i].value, "");
                        
                        //alert("After: '" + hiddenField.value + "'  selected option: "+selectedItems.options[i].value);
                        
                        selectedItems.remove(selectedItems.selectedIndex); 
                        i--; 
                        if (objSearchBox)
                            objSearchBox.style.backgroundColor = 'white';                                                           
                } 
            } 
        }
    }
    catch (err)
    {
         if (errorControl)
            errorControl.innerText = err.description;
    }
    
    //No postback needed, so please don't remove or change this return value
    return false;
}

function OnItemPickerValidationFailed(error)
{
    var stackTrace = error.get_stackTrace();
    var message = error.get_message();
    var statusCode = error.get_statusCode();
    var exceptionType = error.get_exceptionType();
    var timedout = error.get_timedOut();
   
    // Display the error.    
    var RsltElem = 
        document.getElementById("ResultId");
    //RsltElem.innerHTML = 
    var errorToDisplay = 
        "Stack Trace: " +  stackTrace + "<br/>" +
        "Service Error: " + message + "<br/>" +
        "Status Code: " + statusCode + "<br/>" +
        "Exception Type: " + exceptionType + "<br/>" +
        "Timedout: " + timedout;
    alert("OnItemPickerValidationFailed: " + errorToDisplay);
}

// the !== operator is used to compare type or values and the below statement is used for AJAX
if (typeof(Sys) !== "undefined") Sys.Application.notifyScriptLoaded();


/*** End of Item Picker related Script ********/

/*** Task Multi Edit Grid Support ******/
var dictOnClick = new Object(); //Dictonary of onclick code
function AddItemsToOwnerDropDownList(result, userContext, assignOwnerCtlId)
{
    if (userContext && result)
    {        
        var controls = userContext.split("|");
        var ownerList = document.getElementById(controls[0]);
        var ownerIDs = document.getElementById(controls[1]);
        
        var results = result.split("^");
        var names = results[1].split('|');
        var ids = results[0].split('|');
       
        ///----------------------------------------------------------------------------------------------
        /// change assign owner buttons URL with respect to the memberid querystring parameter 
        /// this feature will allow the popup to display nonsaved owners but have been added using
        // the popup and then the popup closed and reopened.
        var assignOwnerButton = document.getElementById(assignOwnerCtlId);
        var popupURL = assignOwnerButton.attributes["onclick"].value;
        //Because IE will blank this out the next time you check, we can get it from the dictionary 
        if (typeof dictOnClick[assignOwnerCtlId] != 'undefined' && dictOnClick[assignOwnerCtlId]) {
          popupURL = dictOnClick[assignOwnerCtlId];
        }

        
        //removes any extra javascript tags?
        if (popupURL.search("javascript:javascript:") > -1)
        {
            popupURL = popupURL.substr("javascript:".length);
        }
        var splitURL = popupURL.split('&');
        var splitQS = splitURL[1].split(',');
        var replaceText = splitQS[0];
        var urlComma = '%7c';
        
        replaceText = 'MemberID=';
        var idx;
        for (idx = 0; idx < ids.length; idx++)
        {
            if (ids[idx] != '')
            {
                replaceText += ids[idx] + urlComma;
            }
        }
        splitQS[0] = '&' + replaceText;
        if(splitURL.length > 2){
          splitQS[0] += '&';
        }
        else{
        splitQS[0] += "'";
        }
        
         
        popupURL = '';
        popupURL += splitURL[0];
        for (idx=0;idx<splitQS.length;idx++)
        {            
            popupURL += splitQS[idx] + ',';
        }
        popupURL = popupURL.substr(0, popupURL.length-1);
        if(splitURL.length >= 2){
          for(idx = 2; idx < splitURL.length;idx++){
            popupURL += splitURL[idx] ;
          }
        }
        
      
        //Remove any return false statements at the end
        var returnfFalse = 'return false;';
        if (popupURL.endsWith(returnfFalse)) {
          popupURL = popupURL.substr(0, popupURL.length - returnfFalse.length)
        }

        dictOnClick[assignOwnerCtlId] = popupURL; //Saving the Onclick Code becasue IE will blank this out the next time you check

        assignOwnerButton.onclick = function () { eval(popupURL); return false; }; // nosemgrep: javascript.browser.security.eval-detected.eval-detected (Needed for Task Grid to work the Popup URL is not user input and should be safe)        
        /// end of changing the URL.
        ///----------------------------------------------------------------------------------------------
        
        try
        {            
            if (ownerList != null)
            {
                var currentValues = results;
                var alreadyExists = false;
            
                if (!alreadyExists)
                {    
                    var offset = 0;
                    ownerList.value = '';
                    ownerIDs.value = '';
                    ownerList.style.backgroundColor='#ffa';
                    for (var i = 0; i < ids.length; i++)
                    {
                        //var oOption = document.createElement("OPTION");
                        if (ids[i] == '0' || ids[i] == '' || typeof(ids[i]) == 'undefined' )
                        {
                            offset++;
                        }
                        else
                        {
                            ownerList.value += names[i-offset] + '\n';
                            ownerIDs.value += ids[i] + '|';
                        }
                    }
                    
                    if ("createEvent" in document) {
                      var evt = document.createEvent("HTMLEvents");
                      evt.initEvent("change", false, true);
                      ownerList.dispatchEvent(evt);
                    }
                    else {
                      ownerList.fireEvent("onchange");
                    }
                }
            }
        }
        catch (err)
        {
            alert("Error while adding a task owner from popup " + err.description);
        }
    }
}

/*** End of Task Multi Edit Grid Support *****/


/**** Tagger control code for people picker ****/


function RemoveTagging(hiddenData , display, memberID)
{
    // remove text from display    
    RemoveDisplayTaggingText(display, memberID);
    RemoveHiddenTaggingText(hiddenData, memberID);
}

function RemoveHiddenTaggingText(hiddenData, memberID)
{

    var displayText = hiddenData.value;
    var memberRows = displayText.split('|');
    
    for (var i = 0; i < memberRows.length; i++)
    {
        if (memberRows[i] != '' && memberRows[i] != '0')
        {
            var varRow = memberRows[i].split(',');
            var itrMemberID = varRow[0].split('=')[1].split('^')[0];
            if (itrMemberID == memberID)
            {
                memberRows[i] = '';
            }
        }
    }
    
    // rewrite the the display text with data
    displayText = '';
    for (i = 0; i < memberRows.length; i++)
    {
        if (memberRows[i] != '')
        {
            displayText += memberRows[i] + '|';
        }
    }
    
    hiddenData.value = displayText;
}

function RemoveDisplayTaggingText(display, memberID)
{
    var displayText = display.value;
    // find the line with the memberid
    var posOfId = displayText.search("("+memberID+")");
    if (posOfId > -1)
    {
        // remove the line - delimiter == '\n'
        if (display.rows == 1)
        {
            displayText = '';
        }
        else
        {
            // have to find the line
            var totalLines = displayText.split('\n').length - 1;
            var objTotalLines = displayText.split('\n');
            
            if (totalLines == 1)
            {
                displayText = '';
            }
            else
            {  
                var beginDeletePos = 0;
                var endDeletePos = 0;
                var totalLineCharCount = 0;
                var whichLineIsIt;
                
                for (var i = 0; i < totalLines; i++)
                {
                    totalLineCharCount += objTotalLines[i].length;
                    endDeletePos = totalLineCharCount;
                    if (posOfId >= beginDeletePos &&  posOfId <= endDeletePos)
                    {
                        // line is found here...
                        objTotalLines[i] = '';
                    }
                    beginDeletePos = endDeletePos;
                }
                
                // rewrite the display message
                displayText = '';
                for (i = 0; i < totalLines; i++)
                {
                    if (objTotalLines[i] != '')
                    {
                        displayText += objTotalLines[i];
                    }
                }
            }
        }
    }
    display.value = displayText;
}

/**** end of Tagger control code for people picker ****/

/*****Start of Recurrence Control Script********/

function RecurPatternType_ShowDiv(bShow)
{
  var item=document.getElementById("recurCustomDiv");
  if (item !=null) { item.style.display=bShow?'block':'none'; }
}

function RecurPatternType_ShowRecurType(id)
{
var key ;var item;
var a=RecurrenceControlCustomDiv;
var c=RecurrenceControlInterval;

for (key in a)
{
  item=document.getElementById(a[key]);
  if (item !=null)
	{ item.style.display='none';}
}

  item=document.getElementById(a[parseInt(id)]);
  if (item !=null) 
  { 
    var txt = document.getElementById(c[parseInt(id)]);
    
    if(txt!=null)
    {
        if(txt.value=="")
            txt.value="1"; // default
    }
    
    item.style.display='block'; 
  }
  
  //RecurPatternType_ShowDiv((itemID.value==6)?false:true);
  
}

/******End of Recurrence Control Script*********/

function CreateEnsureEx(szProgId)
{
    try
    {
        return new ActiveXObject(szProgId);
    }
    catch(e)
    {
        return null;
    }
}

var o_lvl;
var doc_mgr;

function CreateDocumentManager(editorID)
{
    if(doc_mgr)
        return doc_mgr;
    
    doc_mgr = CreateEnsureEx(editorID + ".3");
	o_lvl = 3;
	
    if(!doc_mgr)
    {
        doc_mgr = CreateEnsureEx(editorID + ".2");
        o_lvl = 2;
    }
    
    if(!doc_mgr)
    {
        doc_mgr = CreateEnsureEx(editorID + ".1");
        o_lvl = 1;
    }
    
    if(!doc_mgr)
    {
        o_lvl = 0;
    }
    
    return doc_mgr;
}

function GetMetadataControl(mdFieldcontrolID)
{
    var ctl;
    try{
         ctl = document.getElementById(mdFieldcontrolID);
    }
    catch(e) { }
    
    //if(ctl==null)
    //   alert('Unable to find metadata field: ' + mdFieldcontrolID);
    
    return ctl;
}

function EnableMetadataRequiredFieldValidator(mdFieldcontrolID)
{
    SetMetadataRequiredFieldValidatorState(mdFieldcontrolID, true);
}

function DisableMetadataRequiredFieldValidator(mdFieldcontrolID)
{
    SetMetadataRequiredFieldValidatorState(mdFieldcontrolID, false);
}

function SetMetadataRequiredFieldValidatorState(mdFieldcontrolID, enabled)
{
    

    var updated = false;
    for(var idx=0; idx < Page_Validators.length; idx++)
    {
        var validator = Page_Validators[idx];
       
        if(validator.controltovalidate==mdFieldcontrolID)
        {
            ValidatorEnable(validator, enabled);
            updated = true;
        }    
    }

    if(!updated)
        return;
    
    var ctl = GetMetadataControl(mdFieldcontrolID);

    if(ctl)
    {
        var container = GetMetadataContainerControl(ctl);
        
        try{
            var label = container.rows[0].cells[0];
            if(label)
            {
                var text = label.children[0].children[0];
            
                if(text){
                    if(!enabled)
                    {
                        text.innerHTML = text.innerHTML.replace("*", ""); // nosemgrep: javascript.browser.security.insecure-document-method.insecure-document-method, javascript.lang.security.audit.incomplete-sanitization.incomplete-sanitization (This is just removing the * not a vunerability)
                    }
                    else
                    {
                        text.innerHTML = text.innerHTML.replace("*", ""); // nosemgrep: javascript.browser.security.insecure-document-method.insecure-document-method, javascript.lang.security.audit.incomplete-sanitization.incomplete-sanitization (This is just removing the * not a vunerability)
                        text.innerHTML += "<FONT color=red>&nbsp;*</FONT>"; // nosemgrep: javascript.browser.security.insecure-document-method.insecure-document-method (This is just add the * with a class not a vunerability)
                    }
                }
            }
        }
        catch(e)
        {
            alert('Unable to set required field validator indicator (*) for:' + mdFieldcontrolID + '.');
        }
    }
}

function EnableMetadataFieldInner(mdFieldcontrolID)
{
    SetMetadataFieldEditability(mdFieldcontrolID, true);
}


function EnableMetadataField(mdFieldcontrolID)
{
    addLoadEvent(EnableMetadataFieldInner(mdFieldcontrolID)); 
}



function ReEnableMetadataFieldOnSubmit(){

    //This was the only way I could figure out if this was a save even vers a nother postback. Sort of a hack.
    var saveCheckBox = document.getElementById('ctl00_PlaceHolderToolbar_isSavePostBack');
    if(saveCheckBox == null){
    return;}
    
    if(saveCheckBox.Checked == true){
        for(mdid in controlsToEnable){
            SetMetadataFieldEditability(controlsToEnable[mdid], true);
        }
    }
}

function DisableMetadataFieldOnLoad(){
    for(mdid in controlsToEnable){
        SetMetadataFieldEditability(controlsToEnable[mdid], false);
    }
    
}



function DisableMetadataFieldOnLoad2(sender, args){
    for(mdid in controlsToEnable){
        SetMetadataFieldEditability(controlsToEnable[mdid], false);
    }
}



var controlsToEnable= new Array();
var arrayIndex=0;
function RegisterDisableMetadataFieldOnAsyncPostback(){    
    Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(DisableMetadataFieldOnLoad);        
}
function DisableMetadataField(mdFieldcontrolID)
{
    controlsToEnable[arrayIndex] = mdFieldcontrolID;
    arrayIndex = arrayIndex+1;
    addPostBackEvent(ReEnableMetadataFieldOnSubmit);       
}


function SetMetadataFieldEditability(mdFieldcontrolID, editable)
{
    var ctl = GetMetadataControl(mdFieldcontrolID);
    
    if (!ctl) {
      return;
    }
    var nodeName = ctl.nodeName.toUpperCase();
    if (nodeName.toLowerCase() === "button" ||
        nodeName.toLowerCase() === "input" ||
      nodeName.toLowerCase() === "select" ||
      nodeName.toLowerCase() === "textarea" ||
      nodeName.toLowerCase() === "optgroup" ||
      nodeName.toLowerCase() === "option" ||
      nodeName.toLowerCase() === "fieldset") {
      ctl.disabled = !editable;
    }
    var buttons = ctl.getElementsByTagName('button');
    var inputs = ctl.getElementsByTagName('input');
    var selects = ctl.getElementsByTagName('select');
    var textareas = ctl.getElementsByTagName('textarea');
    var optgroups = ctl.getElementsByTagName('optgroup');
    var options = ctl.getElementsByTagName('option');
    var fieldsets = ctl.getElementsByTagName('fieldset');



    var contorls = [];
    contorls.push.apply(contorls, buttons);
    contorls.push.apply(contorls, inputs);
    contorls.push.apply(contorls, selects);
    contorls.push.apply(contorls, textareas);
    contorls.push.apply(contorls, optgroups);
    contorls.push.apply(contorls, options);
    contorls.push.apply(contorls, fieldsets);

    for (var z = 0; z < contorls.length; z++) {
      contorls[z].disabled = !editable;
    }

        
}


function ShowMetadataField(mdFieldcontrolID)
{
  //SetMetadataFieldDisplayStyle(mdFieldcontrolID, 'inline');
  var ctl = GetMetadataControl(mdFieldcontrolID);

  if (ctl) {
    try {
      GetMetadataContainerControl(ctl).classList.remove("invisible");
    }
    catch (e)
    { }
  }
}

function HideMetadataField(mdFieldcontrolID)
{

  //SetMetadataFieldDisplayStyle(mdFieldcontrolID, 'none');
  var ctl = GetMetadataControl(mdFieldcontrolID);

  if (ctl) {
    try {
      GetMetadataContainerControl(ctl).classList.add("invisible");
    }
    catch (e)
    { }
  }
}

function SetMetadataFieldDisplayStyle(mdFieldcontrolID, style)
{
    var ctl = GetMetadataControl(mdFieldcontrolID);
    
    if(ctl)
    {
        try{
           GetMetadataContainerControl(ctl).style.display= style;
        }
        catch(e)
        {}
    }
}

function GetMetadataContainerControl(ctl)
{
    if(!ctl.parentElement)
        return ctl;

    if (!ctl.classList || !ctl.classList.contains("EditFieldContainer")) {
        return GetMetadataContainerControl(ctl.parentElement);
    }
    else{
        return ctl;
    }
}

function ToggleMetadataGroupVisibility(mdFieldcontrolID, visible)
{
    var style;
    if(visible)
        style='inline';
    else
        style='none';
        
    var ctl = GetMetadataControl(mdFieldcontrolID);
    if(ctl)
        ctl.style.display= style;
}

function OpenConfirmWindow(documentUrl)
{
        try{$find('dflt_wz_bh').show();}catch(e){}
        var w = window.open(documentUrl, "", "target:_blank");
        window.onfocus  = function()
        {
        	if(location.href.lastIndexOf('UseWizard=true')<1)	        
        	{
        	      RefreshParent(); //Probably not needed due to chrome not supporting opening infopath?
                var result = window.showModalDialog('../RefreshConfirmation.aspx','', 'center:yes;dialogHeight:100px;dialogWidth:350px;status:no;scroll:no;unadorned:yes;');
                location.href = window.location.href;
            }
        }
}

function GetProtocolByFileName(documentUrl) {
  var lowerCaseUrl = documentUrl.toLowerCase();

  if (lowerCaseUrl.endsWith('.docx') ||
      lowerCaseUrl.endsWith('.doc') ||
      lowerCaseUrl.endsWith('.docm')) {
    return "ms-word";
  }
  if (lowerCaseUrl.endsWith('.xls') ||
      lowerCaseUrl.endsWith('.xlsx') ||
      lowerCaseUrl.endsWith('.xlsm')) {
    return "ms-excel";
  }
  if (lowerCaseUrl.indexOf('.xml') > 0) {
    return "ms-infopath";
  }
  if (lowerCaseUrl.endsWith('.mpp')) {
    return "ms-project";
  }  
  if (lowerCaseUrl.endsWith('.pptx') ||
      lowerCaseUrl.endsWith('.ppt')) {
    return "ms-powerpoint";
  }

  return '';
}


function EditOnlineDocument(documentUrl) 
{
  if (isChrome()) {
    var protocolName = GetProtocolByFileName(documentUrl);
    if (protocolName.localeCompare('') != 0) {
      var protocolActivation = protocolName + ":ofe|u|" + encodeURI(documentUrl);
      location.href = protocolActivation;
      return false;
    }
    return ViewOnlineDocument(documentUrl);
  }

  // view and edit work the same for office 2007 but not office 2003.
  //return ViewOnlineDocument(documentUrl);    
  // end of note
	var DocumentManager;
	var fRet;
	var startPos = documentUrl.lastIndexOf('.') + 1;
	
  var endPos = documentUrl.lastIndexOf('?');
	var editorID;
	var extension;

	if(endPos>1)
	    extension= documentUrl.substring(startPos, endPos).toLowerCase();
	else
	    extension= documentUrl.substring(startPos).toLowerCase();
	

  var allowed = "doc|docx|docm|xls|xlsx|ppt|pptx|xml|xsn";
		
	// account for direct file links
	if(documentUrl.substr(0,5)=="file:"){return;}
		
	try
	{	
	    if(allowed.indexOf(extension)<0)
	    {
	        window.open(documentUrl, "", "target:_blank");
	        if (event)
            {
                event.cancelBubble = true;
                event.returnValue = false;
            }
	        
	       return false;
	    }
	    
		if (extension == 'xml')
		{
	        //editorID = 'SharePoint.OpenXMLDocuments';
	        var delimiter = "?";
	        
	        if(documentUrl.lastIndexOf('?')>1)
	        {
	            delimiter = "&";
            }
	        
	        OpenConfirmWindow(documentUrl + delimiter + "NoRedirect=true"); // updated to account for infopath client issues
	            
	        return;
        }
	    else
            editorID = 'SharePoint.OpenDocuments';   
         
        if (documentUrl.substr(startPos) == 'txt')
        {	    
            var newWindow = window.open(documentUrl);
            
            if (window.focus)
                newWindow.focus();
        }
        else
        {
           DocumentManager = CreateDocumentManager(editorID);
           
           if (documentUrl.substr(startPos) == 'xml')
              o_lvl = 2; // hack for infopath
        }     
 
   
	    if (DocumentManager)	
	    {
	        switch(o_lvl)
	        {
	            case 3:
	                fRet = DocumentManager.EditDocument3(window, documentUrl, false); 		
	                break;
		        case 2:
		            if (documentUrl.substr(startPos) == 'xml')
		            {
		                fRet = DocumentManager.EditDocument2(window, documentUrl, 'InfoPath.Document'); 		
		                first = 0;
		            }
		            else
                        fRet = DocumentManager.EditDocument2(window, documentUrl); 		
		            break;
		        case 1:
		            fRet = DocumentManager.EditDocument(documentUrl); 		
		            break;
		        
		        case 0:
		            var ver = getInternetExplorerVersion();		        
		            if(navigator.userAgent.indexOf("x64") !=-1 ||  ver < 6  ){
		                 alert("To open this file please use the 32-bit version of Internet Explorer"); 		            
		            }
		            else{
		                alert('Unable to create ' + editorID);    
		            }
		            fRet = false;
		            break;		   
		    }
	    } 
	    else{
	        var ver = getInternetExplorerVersion();		        
	        if(navigator.userAgent.indexOf("x64") !=-1 || ver < 6){
		      alert("To open this file please use the 32-bit version of Internet Explorer"); 		            
		    }
		    else{
	            alert('Unable to create ' + editorID);    
	        }
	        fRet = false;
	    }
    }
    catch(e)
    {
        fRet = false;
        alert(e.message);
    }
	
		
	
    // We need to allow the event to be processes, so the system can detect when user has checked in document from office applications
    if(fRet)
        window.onfocus = RefreshOnFocus;
	
	if (event)
    {
        event.cancelBubble = true;
        event.returnValue = false;
    }
	return false;
}


function getInternetExplorerVersion()
// Returns the version of Internet Explorer or a -1
// (indicating the use of another browser).
{
  var rv = -1; // Return value assumes failure.
  if (navigator.appName == 'Microsoft Internet Explorer')
  {
    var ua = navigator.userAgent;
    var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
    if (re.exec(ua) != null)
      rv = parseFloat( RegExp.$1 );
  }
  return rv;
}

var g_varSkipRefreshOnFocus = 0;
var first = 1;
function RefreshOnFocus()
{
    if ((typeof(g_varSkipRefreshOnFocus) == "undefined" ||!g_varSkipRefreshOnFocus) && !first)
    {
        window.onbeforeunload = DisableRefreshOnFocus;
        
        var url=window.location.href;
		var iPosition=url.indexOf("#")
		if (iPosition==-1)
			window.location.href=url;
		else
			window.location.href=url.substring(0, iPosition);
    }
    else
    {
       first = 0;
    }
}
function DisableRefreshOnFocus()
{
    g_varSkipRefreshOnFocus = 1;
}

function OpenNewForm(documentUrl)
{
  window.location = 'ms-infopath:nft|u|' + documentUrl;
  if (event) {
    event.cancelBubble = true;
    event.returnValue = false;
  }
  return false;
  
}

function ViewOnlineDocumentOpenAll(documentUrl) {
  if (!isChrome()) {
    return ViewOnlineDocument(documentUrl, false);
  }
  return ViewOnlineDocument(documentUrl, true);
}

function ViewOnlineDocument(documentUrl) {
  return ViewOnlineDocument(documentUrl, false);
}

function ViewOnlineDocument(documentUrl, openInNewTab) 
{
  if (isChrome()) {    
    var protocolName = GetProtocolByFileName(documentUrl);
    if (protocolName.localeCompare('') != 0) {
      if (protocolName.localeCompare('ms-infopath') == 0) { //Infopath doesnt support Open for View (OPV)
        var protocolActivation = protocolName + ":ofe|u|" + encodeURI(documentUrl);;
      }
      else {
        var protocolActivation = protocolName + ":ofv|u|" + encodeURI(documentUrl);;
      }
      if (openInNewTab) {
        window.open(protocolActivation, '_blank');
      } else {
        location.href = protocolActivation;
      }
      return false;
    }
    
    if (documentUrl.indexOf('xsnLocation') !== -1) {
      alert('Please use Internet Explorer to open this InfoPath Form.');
      return false;
    };
    window.top.location.href = documentUrl;
    return false;
  }
	var DocumentManager;
	var fRet;
	var startPos = documentUrl.lastIndexOf('.') + 1;
	var endPos = documentUrl.lastIndexOf('?');
	var editorID;
	var extension;

	if(endPos>1)
	    extension= documentUrl.substring(startPos, endPos).toLowerCase();
	else
	    extension= documentUrl.substring(startPos).toLowerCase();
	 
	var allowed = "doc|docx|docm|xls|xlsx|ppt|pptx|xml|xsn";
	
	// account for direct file links
	if(documentUrl.substr(0,5)=="file:"){return;}
		
	try
	{	
	    if(allowed.indexOf(extension)<0)
	    {
	        window.open(documentUrl, "", "target:_blank");
	        if (event)
            {
                event.cancelBubble = true;
                event.returnValue = false;
            }

	       return false;
	    }
	     
	
	    if (extension == 'xml')
		{
	        var delimiter = "?";
	        
	        if(documentUrl.lastIndexOf('?')>1)
	        {
	            delimiter = "&";
            }
	        
	        OpenConfirmWindow(documentUrl + delimiter + "NoRedirect=true"); // updated to account for infopath client issues
	        
	        return;
        }
	    else
            editorID = 'SharePoint.OpenDocuments';   
         
        if (documentUrl.substr(startPos) == 'txt')
        {	    
            var newWindow = window.open(documentUrl);
            
            if (window.focus)
                newWindow.focus();
        }
        else
        {
           DocumentManager = CreateDocumentManager(editorID);
           
           if (documentUrl.substr(startPos) == 'xml')
              o_lvl = 2; // hack for infopath
        }     
 
   
	    if (DocumentManager)	
	    {
	        switch(o_lvl)
	        {
	            case 3:
	                fRet = DocumentManager.ViewDocument3(window, documentUrl, 1); 		
	                break;
		        case 2:
		            if (documentUrl.substr(startPos) == 'xml')
		            {
		                fRet = DocumentManager.EditDocument2(window, documentUrl, 'InfoPath.Document'); 		
		                first = 0;
		                
		            }
		            else
                        fRet = DocumentManager.ViewDocument2(window, documentUrl); 		
		            break;
		        case 1:
		            fRet = DocumentManager.ViewDocument(documentUrl); 		
		            break;
		        
		        case 0:
		            var ver = getInternetExplorerVersion();
		            if(navigator.userAgent.indexOf("x64") !=-1 || ver<6){
		                alert("To open this file please use the 32-bit version of Internet Explorer"); 		            
		            }
		            else{
    		            alert('Unable to create ' + editorID);    
		            }
		            fRet = false;
		            break;		   
		    }
	    } 
	    else{
	        var ver = getInternetExplorerVersion();
	        if(navigator.userAgent.indexOf("x64") !=-1 || ver<6){
		      alert("To open this file please use the 32-bit version of Internet Explorer"); 		            
		    }
		    else{
		        alert('Unable to create ' + editorID);    
            }
	        fRet = false;
	    }
    }
    catch(e)
    {
        fRet = false;
        alert(e.message);
    }
	
	
    // We need to allow the event to be processes, so the system can detect when user has checked in document from office applications
    //if(fRet)
	  //  window.onfocus = RefreshOnFocus;
	
	if (event)
    {
        event.cancelBubble = true;
        event.returnValue = false;
    }
	return false;
}

            
//----------------------------------
// Details Popup Scripts
//----------------------------------
var req;
var evt_ctl;
var popup_ctl;
var isTop;
var showPopUp;

function showDetails(obj, url) {
  evt_ctl = obj;  
  popup_ctl = document.getElementById('tmpDetailsContainer');
  showPopUp = url;
  isTop = isUpperHalf();
  showDetailsProgress();
  
  // may need to check for ? and &
  url += "&TimeZoneOffset=" + GetLocalTimeOffset();
  
  retrieveURL(url);
}

function clearDetails (){
    popup_ctl.style.display = 'none';
    showPopUp = '';
}

function showDetailsPopup() {
  
  popup_ctl.style.position = "absolute";
  popup_ctl.style.display = "block";
  popup_ctl.style.zIndex = 1000;
  
  var divH = parseInt(popup_ctl.offsetHeight);
  
  if(isTop){
        popup_ctl.style.top = getTop((evt_ctl.offsetHeight+2)) +"px";
    }
    else{
        popup_ctl.style.top = getTop((divH*-1)) +"px";
    }
    
    popup_ctl.style.left = getLeft(0)+"px";
}

function getTop(right_offset)
{
  var l = 0;
  var p = evt_ctl.offsetParent;
  while(p!=null)
  {
    l += p.offsetTop;
    p = p.offsetParent;
  }  
  right_offset--;
  
  return (l+right_offset);
}

function getLeft(left_offset)
{
  var l = 0;
  var p = evt_ctl.offsetParent;
  while(p!=null)
  {
    l += p.offsetLeft;
    p = p.offsetParent;
  }  
  
  left_offset--;
  
  return (l+left_offset);
}

function isUpperHalf()
{
    return event.clientY<(document.documentElement.scrollHeight/2);
}

function showDetailsProgress()
{
    var progress = document.getElementById('tmpDetailsProgress');
    progress.innerHTML = "<div class='progress'><img src='/App_Themes/xCCB_Blue/images/loading.gif' alt='...'/></div>";
    progress.style.position = "absolute";
    progress.style.display = "block";
    progress.style.top = getTop(0) +"px";
    progress.style.left = getLeft(0) +"px";
}

function hideDetailsProgress()
{
    document.getElementById('tmpDetailsProgress').innerHTML = "";
}

function retrieveURL(url) {
  if (window.XMLHttpRequest) { // Non-IE browsers
    req = new XMLHttpRequest();
    req.onreadystatechange = processStateChange;
    try {
      req.open("GET", url, true);
    } catch (e) {
      //      alert(e);
    }
    req.send(null);
  } else if (window.ActiveXObject) { // IE
    req = new ActiveXObject("Microsoft.XMLHTTP");
    if (req) {
      req.onreadystatechange = processStateChange;
      req.open("GET", url, true);
      req.send();
    }
  }
}

function processStateChange() {
  if (req.readyState == 4) { // Complete
    if (req.status == 200) { // OK response
        hideDetailsProgress();
        if(showPopUp != ''){
            popup_ctl.innerHTML = req.responseText; // nosemgrep: javascript.browser.security.insecure-document-method.insecure-document-method (server output is trusted)            
            showDetailsPopup();
        }

    } else {
            alert("Error retrieving details: " + req.statusText);
    }
  }

}



//----------------------------------
// End Details Popup Scripts
//----------------------------------

function getURLParam(strParamName){
  var strReturn = "";
  var strHref = window.location.href;
  if ( strHref.indexOf("&") > -1 ){
    var strQueryString = strHref.substr(strHref.indexOf("&")).toLowerCase();
    var aQueryString = strQueryString.split("&");
    for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
      if (
	  aQueryString[iParam].indexOf(strParamName + "=") > -1 ){
        var aParam = aQueryString[iParam].split("=");
        strReturn = aParam[1];
        break;
      }
    }
  }
  
  alert(strReturn);
  return strReturn;
}

function ClearSelect (s) {
  for (var i = 0; i < s.options.length; i++) {
    s.options[i] = null;
  }
  if (s.options.length != 0) {
     ClearSelect (s);
  }
}
function Append2Select(s, val,text) {
  s.options[s.options.length] = new Option (text, val);
}

/*****Start of Meeting Management Script********/
function ShowHideElementBasedonRadiobutton(radioElementID, showElementID, hideElementID) {
    var radioElement = document.getElementById(radioElementID);
    if (radioElement != null)
    {   
        if (radioElement.checked == true)
        {
            ShowElement(showElementID);
            HideElement(hideElementID);
        }
    }
}

function ShowElement(elementID) {
    var item = document.getElementById(elementID);
    if (item != null)
        item.style.display = 'block'; 

}

function HideElement(elementID) {
    var item = document.getElementById(elementID);
    if (item != null)
        item.style.display = 'none'; 
}

function MtgNavigate(instancedate)
{
	if (instanceId==g_instanceId)
		return;
	window.location.href='MeetingDetails.aspx?InstanceDate='+instancedate+'&'+g_thispagedata;
}


/*****End of Meeting Management Script********/


/***** Start Calendar Control Script  ********/
var PopupWindow=null;

function OpenCalendar(textBoxId, flag)
{	
    var txtBox = document.getElementById(textBoxId);
    if(txtBox.disabled)
        return false;

	// Close other calendar control if open
	if(PopupWindow != null)
	{
		PopupWindow.close();
	}

	var leftprop, topprop, screenX, screenY, cursorX, cursorY, padAmt, height, width
	width=210;
	height=240;
	leftprop  = event.screenX;
	topprop = event.screenY;
	cursorX = event.screenX;
	cursorY =event.screenY;
	padAmtX = 0;
	padAmtY = 0;
	
	if(navigator.appName == "Microsoft Internet Explorer")
	{
		screenY = window.screen.availHeight;//document.body.offsetHeight		
		screenX = window.screen.availWidth
	}
	else
	{ 
		// Navigator coordinates
		screenY = screen.height;
		screenX = screen.width;
	}
	
	//alert("cursorY: " + cursorY + "height : " + height + "padAmtY : " + padAmtY)
	if((cursorY + height + padAmtY) > screenY)	
	// make sizes a negative number to move left/up
	{
		padAmtY = (height*-1);	
		// if up or to left, make 30 as padding amount
	}
	if((cursorX + width + padAmtX) > screenX)
	{
		padAmtX = (10) + (width*-1);	
		// if up or to left, make 30 as padding amount
	}

	if(navigator.appName == "Microsoft Internet Explorer")
	{
		leftprop = cursorX + padAmtX
		topprop = cursorY + padAmtY
	}
	else
	{ // adjust Netscape coordinates for scrolling
		leftprop = (cursorX - pageXOffset + padAmtX)
		topprop = (cursorY - pageYOffset + padAmtY)
	}
	
	// Get the name of the server form
		
    var settings="width=205,height=215,left="+leftprop+",top="+topprop+",location=no,directories=no,menubar=no,toolbar=no,status=no,scrollbars=no,resizable=no,dependent=no";
    var url = window.location.protocol + "//" + window.location.hostname + "/controls/calendar.aspx?selected=" + txtBox.value + "&id=" + textBoxId + "&postBack=false"
    PopupWindow = window.open(url,'Calendar',settings);
	PopupWindow.focus();
	return false;
}

function SetDate(textBoxId, newDate, postBack)
{
	var txtBox = document.getElementById(textBoxId);	
	// Close the pop up window for calendar control
	PopupWindow.close();
	txtBox.value = newDate;

	var event; // The custom event that will be created

	if (document.createEvent) {
	  event = document.createEvent("HTMLEvents");
	  event.initEvent("change", true, true);
	  txtBox.dispatchEvent(event);
	} else {
	  event = document.createEventObject();
	  event.eventType = "onchange";
	  txtBox.fireEvent('onchange');
	}
	

	//txtBox.fireEvent('onchange');
	// Postback if needed
	if (postBack)
	__doPostBack(id,'');
}

/***** End Calendar Control Script  ********/


var Url = {
 
	// public method for url encoding
	encode : function (string) {
		return escape(this._utf8_encode(string));
	},
 
	// public method for url decoding
	decode : function (string) {
		return this._utf8_decode(unescape(string));
	},
 
	// private method for UTF-8 encoding
	_utf8_encode : function (string) {
		string = string.replace(/\r\n/g,"\n");
		var utftext = "";
 
		for (var n = 0; n < string.length; n++) {
 
			var c = string.charCodeAt(n);
 
			if (c < 128) {
				utftext += String.fromCharCode(c);
			}
			else if((c > 127) && (c < 2048)) {
				utftext += String.fromCharCode((c >> 6) | 192);
				utftext += String.fromCharCode((c & 63) | 128);
			}
			else {
				utftext += String.fromCharCode((c >> 12) | 224);
				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
				utftext += String.fromCharCode((c & 63) | 128);
			}
 
		}
 
		return utftext;
	},
 
	// private method for UTF-8 decoding
	_utf8_decode : function (utftext) {
		var string = "";
		var i = 0;
		var c = c1 = c2 = 0;
 
		while ( i < utftext.length ) {
 
			c = utftext.charCodeAt(i);
 
			if (c < 128) {
				string += String.fromCharCode(c);
				i++;
			}
			else if((c > 191) && (c < 224)) {
				c2 = utftext.charCodeAt(i+1);
				string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
				i += 2;
			}
			else {
				c2 = utftext.charCodeAt(i+1);
				c3 = utftext.charCodeAt(i+2);
				string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
				i += 3;
			}
 
		}
 
		return string;
	}
}

function getQueryStringValue(name) { 
  var query = window.location.search.substring(1); 
  var vars = query.split("&"); 
  for (var i=0;i<vars.length;i++) { 
    var pair = vars[i].split("="); 
    if (pair[0] == name) { 
      return pair[1]; 
    } 
  } 
  return "";
} 

var Browser = { 
 Version: function() {    
    var version = 999; // we assume a sane browser    
    if (navigator.appVersion.indexOf("MSIE") != -1)      
        // bah, IE again, lets downgrade version number     
         version = parseFloat(navigator.appVersion.split("MSIE")[1]); 
   return version;  
   }
}

function DeselectAll(selObj)
{
    
    for (i = 0; i < selObj.options.length; i ++)
    {
        selObj.options[i].selected = false;
    }
}

function updateIFrameHeight(iFrame){
    //find the height of the internal page
    var the_height= iFrame.contentWindow.document.body.scrollHeight;
    
    //change the height of the iframe
    iFrame.height= the_height;
}

function hideLoading(component){
    if(document.getElementById('iFrame'+component).src != ''){                  
        var loading = document.getElementById('loading'+component);
        loading.style.visibility = 'hidden'; 
        loading.style.display = 'none';
    }
}

//if (Browser.Version() < 7) {  ... // if client is using IE6 or lower, run this code}
//if (Browser.Version() >= 7) {  ... // if client is using IE7 or a sane browser, run this code}


var currentDropDownClicked = null;

  function tamingselect()
{
	if(!document.getElementById && !document.createTextNode){return;}
	
// Classes for the link and the visible dropdown
	var ts_selectclass='turnintodropdown'; 	// class to identify selects
	var ts_listclass='turnintoselect';		// class to identify ULs
	
	var ts_boxclass='dropcontainer'; 		// parent element
	var ts_triggeron='activetrigger'; 		// class for the active trigger link
	var ts_triggeroff='trigger';			// class for the inactive trigger link
	var ts_dropdownclosed='dropdownhidden'; // closed dropdown
	var ts_dropdownopen='dropdownvisible';	// open dropdown
	var ts_dropdownopentop='dropdownvisibletop';	// open dropdown
/*
	Turn all selects into DOM dropdowns
*/
	var count=0;
	var toreplace=new Array();
	var sels=document.getElementsByTagName('select');
	for(var i=0;i<sels.length;i++){
		if (ts_check(sels[i],ts_selectclass))
		{
			var hiddenfield=document.createElement('input');
			hiddenfield.name=sels[i].name;
			hiddenfield.type='hidden';
			hiddenfield.id=sels[i].id;
			hiddenfield.value=sels[i].options[sels[i].selectedIndex].value;
			sels[i].parentNode.insertBefore(hiddenfield,sels[i])
			var trigger=document.createElement('a');
			ts_addclass(trigger,ts_triggeroff);
			trigger.href='#';
			trigger.onclick=function(){
			    if(currentDropDownClicked == null){
			        currentDropDownClicked = this;
				    ts_swapclass(this,ts_triggeroff,ts_triggeron)
    				
    				
				    var winW = 630, winH = 460;
                    if (document.body && document.body.offsetWidth) {                 
                     winH = document.body.offsetHeight;
                    }
                    if (document.compatMode=='CSS1Compat' &&
                        document.documentElement &&
                        document.documentElement.offsetWidth ) {
                     
                     winH = document.documentElement.offsetHeight;
                    }
                    if (window.innerWidth && window.innerHeight) {
                     
                     winH = window.innerHeight;
                    }
                    
                    var ul = this.parentNode.getElementsByTagName('ul')[0];
                    
                    
                    var ele = ul;
                    var x = 0;
                    while(ele){
                       x += ele.offsetTop;
                       ele = ele.offsetParent;
                    }
                    
                    
                    if( (x +215) > winH){
                        ts_swapclass(ul,ts_dropdownclosed,ts_dropdownopentop);								
                    }
                    else{
				        ts_swapclass(ul,ts_dropdownclosed,ts_dropdownopen);								
				    }
				}
				return false;
			}
			trigger.appendChild(document.createTextNode(sels[i].options[sels[i].selectedIndex].text));
			sels[i].parentNode.insertBefore(trigger,sels[i]);
			var replaceUL=document.createElement('ul');
			for(var j=0;j<sels[i].getElementsByTagName('option').length;j++)
			{
				var newli=document.createElement('li');
				var newa=document.createElement('a');
				newli.v=sels[i].getElementsByTagName('option')[j].value;
				newli.elm=hiddenfield;
				newli.istrigger=trigger;
				newa.href='#';
				newa.className = 'activeDropdownLink' ;
				newa.appendChild(document.createTextNode(
				sels[i].getElementsByTagName('option')[j].text));
				newli.onclick=function(){ 
				    
					this.elm.value=this.v;					
					ts_swapclass(this.istrigger,ts_triggeron,ts_triggeroff);
					
					this.parentNode.className = ts_dropdownclosed;	
					this.istrigger.firstChild.nodeValue=this.firstChild.firstChild.nodeValue;
					__doPostBack(this.elm.id,'');
					currentDropDownClicked = null;
					return false;
				}
				newli.appendChild(newa);
				replaceUL.appendChild(newli);
			}
			ts_addclass(replaceUL,ts_dropdownclosed);
			var div=document.createElement('div');			
			div.appendChild(replaceUL);
			ts_addclass(div,ts_boxclass);
			
			sels[i].parentNode.insertBefore(div,sels[i])
			toreplace[count]=sels[i];
			count++;
			
			document.onclick = function(e){			    
			    if(currentDropDownClicked != null){
			        e = e || window.event;
                    e = e.target || e.srcElement;
                    var ul = currentDropDownClicked.parentNode.getElementsByTagName('ul')[0];
                    if(e.className != currentDropDownClicked.className){
				        ts_swapclass(currentDropDownClicked,ts_triggeron,ts_triggeroff);					    				    
				        ul.className = ts_dropdownclosed;	
				        currentDropDownClicked = null;					    				    
				        return false;
				    }
                    
                }
			}
			
		}
	}
	
/*
	Turn all ULs with the class defined above into dropdown navigations
*/	

	var uls=document.getElementsByTagName('ul');
	for(var i=0;i<uls.length;i++)
	{
		if(ts_check(uls[i],ts_listclass))
		{
			var newform=document.createElement('form');
			var newselect=document.createElement('select');
			for(j=0;j<uls[i].getElementsByTagName('a').length;j++)
			{
				var newopt=document.createElement('option');
				newopt.value=uls[i].getElementsByTagName('a')[j].href;	
				newopt.appendChild(document.createTextNode(uls[i].getElementsByTagName('a')[j].innerHTML));	
				newselect.appendChild(newopt);
			}
			newselect.onchange=function()
			{
				window.location=this.options[this.selectedIndex].value;
			}
			newform.appendChild(newselect);
			uls[i].parentNode.insertBefore(newform,uls[i]);
			toreplace[count]=uls[i];
			count++;
		}
	}
	for(i=0;i<count;i++){
		toreplace[i].parentNode.removeChild(toreplace[i]);
	}
	function ts_check(o,c)
    {        
        return new RegExp('\\b' + c + '\\b').test(o.className);  // nosemgrep: javascript.lang.security.audit.detect-non-literal-regexp.detect-non-literal-regexp (required for the system to work)        
	}
	function ts_swapclass(o,c1,c2)
	{
		var cn=o.className
		o.className=!ts_check(o,c1)?cn.replace(c2,c1):cn.replace(c1,c2);
	}
	function ts_addclass(o,c)
	{
		if(!ts_check(o,c)){o.className+=o.className==''?c:' '+c;}
	}
	function getFirstIDofParent(element){
	    var e = element;
	    if(e==null){
	        return null;
	    }
	    e = currentDropDownClicked.parentNode.getElementsByTagName('ul')[0];
	    
	    while(e.id == null || e.id == ''){
	        e=e.parentElement;	        
	        if(e==null){
	            return null;
	        }
	    }
	    return e.id;
	    
	}
	
  }

  function isChrome() {
    var isChromium = window.chrome;
    var winNav = window.navigator;
    var vendorName = winNav.vendor;
    var isOpera = typeof window.opr !== "undefined";
    var isIEedge = winNav.userAgent.indexOf("Edge") > -1;
    var isIOSChrome = winNav.userAgent.match("CriOS");

    if (isIOSChrome) {
      // is Google Chrome on IOS
      return true;
    } else if (
      isChromium !== null &&
      typeof isChromium !== "undefined" &&
      vendorName === "Google Inc." &&
      isOpera === false &&
      isIEedge === false
    ) {
      // is Google Chrome
      return true;
    } else {
      // not Google Chrome 
      return false;
    }
  }


function clientValidate() {
  // Consider using this Client side validation
  //if (typeof (Page_ClientValidate) == 'function') {
  //if (Page_ClientValidate() == false)
  //    {
  //return false; }
  //    }

  var retValue = true;
  for (i = 0; i < Page_Validators.length; i++) {
    ValidatorValidate(Page_Validators[i]);
    if (Page_Validators[i].isvalid == false)
      retValue = false;
  }
  return retValue;
}


function waitForDialogToClose(model) {
  var timer = setInterval(function () {
    if (model.closed) {
      clearInterval(timer);
      window.showModalDialog.onCloseFunction(model.returnValue);
    }
  }, 1000);
}

function reloadPage() {
  window.location.reload();
}

function RefreshParent() {
  SetModalDialogOnClose(reloadPage);
}

function SetModalDialogOnClose(onCloseFunction) {
  if (isChrome()) {
    window.showModalDialog.processOnClose = true;
    window.showModalDialog.onCloseFunction = onCloseFunction
  }
}


ChromePopup = function (url, arg, feature) {
  
  var opFeature = feature.split(";");
  var featuresArray = new Array()
  for (var i = 0; i < opFeature.length - 1; i++) {
    var f = opFeature[i].split(":");
    featuresArray[f[0].toString().trim().toLowerCase()] = f[1].toString().trim();
  }

  var h = "200px", w = "400px", l = "100px", 
  t = "100px", r = "no", c = "yes", s = "no";
  if (featuresArray["dialogheight"]) h = featuresArray["dialogheight"];
  if (featuresArray["dialogwidth"]) w = featuresArray["dialogwidth"];
  if (featuresArray["dialogleft"]) l = featuresArray["dialogleft"];
  if (featuresArray["dialogtop"]) t = featuresArray["dialogtop"];
  if (featuresArray["resizable"]) r = featuresArray["resizable"];
  if (featuresArray["center"]) c = featuresArray["center"];
  if (featuresArray["status"]) s = featuresArray["status"];
  var modelFeature = "height = " + h + ",width = " + w + ",left=" + l + ",top=" + t + ",model=yes,alwaysRaised=yes,directories=no,titlebar=no,toolbar=no, location=no,status=no,menubar=no" + ",resizable= " + r + ",celter=" + c + ",status=" + s;
  var model = window.open(url, "", modelFeature);
  model.dialogArguments = arg;
  // check the new attribute to refresh parent window or not
  if (window.showModalDialog.processOnClose) {
    waitForDialogToClose(model);
  }
  return model;
}

function fixChrome() {
  if (isChrome()) {
    window.showModalDialog = ChromePopup;
  }
}

function IsExtensionSupportedInChromeWithProtocol(url) {
  
  if (url.endsWith('.docx') ||
      url.endsWith('.doc') ||
      url.endsWith('.xls') ||
      url.endsWith('.xlsx') ||
      url.endsWith('.pptx') ||
      url.endsWith('.xml') ||      
      url.endsWith('.ppt') ||
      url.endsWith('.mpp') ||
      url.endsWith('.docm') ||
      url.endsWith('.xlsm') ){
      return true;
  }

  //Add Support for LACCB
  //"https://xccb.amr.ith.intel.com/sites/xCCB_1000088_00-SP2010|_layouts/FormServer.aspx?xsnLocation=https://xccb.amr.ith.intel.com/sites/xCCB_1000088_00-SP2010/LACCB%20Component%20Form/Forms|template.xsn|1832766"
  if (url.indexOf('xsnLocation=') > 0) {
    return true;
  }
  return false;
}

function FixChangeControlToolBarForChrome(url) {

  if (!isChrome() || IsExtensionSupportedInChromeWithProtocol(url)) {
    return;
  }
  var viewLink = document.getElementById('ctl00_PlaceHolderToolbar_ctl00_tb_view');
  if (viewLink && url && url != '' && url.indexOf('.xml') === -1 && url.indexOf('xsnLocation') === -1) {
    viewLink.href = url;
  }
  var editLink  = document.getElementById('ctl00_PlaceHolderToolbar_ctl00_tb_edit');
  if (editLink) {
    editLink.disabled = true;
    editLink.setAttribute("href", "javascript:alert('Online Editing is not supported for this file type.') ");
    editLink.setAttribute("onclick", "javascript:void(0)");
    editLink.setAttribute("style", editLink.getAttribute("style") + ";color:gray");
    editLink.innerHTML = "Edit";
  }
}

function hasClass(target, className) {    
    return new RegExp('(\\s|^)' + className + '(\\s|$)').test(target.className); // nosemgrep: javascript.lang.security.audit.detect-non-literal-regexp.detect-non-literal-regexp (Class name is not user data and is safe)        
}

function WizardResize() {
  var mainDiv = document.getElementById('WizardMainContentDiv');
  if (window.innerHeight > 472) {
    mainDiv.style.height = window.innerHeight - 100 + 'px';
  }
  else {
    mainDiv.style.height = 472+ 'px';
  }
  
}

function EnterKeyFilter() {
  if (window.event.keyCode == 13) {
    event.returnValue = false;
    event.cancel = true;
  }
}

function copyToClipboard(text) {
  var dummy = document.createElement("textarea");
  // to avoid breaking orgain page when copying more words
  // cant copy when adding below this code
  // dummy.style.display = 'none'
  document.body.appendChild(dummy);
  //Be careful if you use texarea. setAttribute('value', value), which works with "input" does not work with "textarea". – Eduard
  dummy.value = text;
  dummy.select();
  document.execCommand("copy");
  document.body.removeChild(dummy);
}

function isEmptyOrSpaces(str) {
  return str === null || str.match(/^ *$/) !== null;
}

//When the change to Chrome, Page_ClientValidate can no longer access the evaluationfunction simply by it being listed as a attribute of a validator, this method looks to see if it is empty then assigns the function specified in the attribute if it exists.
function fixValidators() {
    if (typeof (Page_Validators) == "undefined") {                
        return;
    }
    for (var idx = 0; idx < Page_Validators.length; idx++) {
        var validator = Page_Validators[idx];
        if (validator != null && validator.evaluationfunction ==null) {
            //Check if the evaluationfunction is a property of the elenet 
            var evaluationFunctionProperty = validator.getAttribute('evaluationfunction'); // nosemgrep: javascript.browser.security.eval-detected.eval-detected (nessassary without a complete rewrite)        
            
            if (evaluationFunctionProperty != null) {
                var evaluationFunction = eval(evaluationFunctionProperty);
                if (typeof (evaluationFunction) == "function") {
                    validator.evaluationfunction = evaluationFunction;
                }
            }
        }
    }
}


addLoadEvent(fixChrome);
addLoadEvent(tamingselect);
addLoadEvent(fixValidators);